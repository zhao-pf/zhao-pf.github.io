<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><meta name="keywords" content="[object Object]"><meta name="description" content="主线程请求网络程序闪退，因为网络请求是耗时操作，所以我们一般都需要在新的线程中执行
可以尝试一下"><meta name="author" content="赵鹏飞"><title>主线程请求网络程序闪退 - 赵鹏飞的笔记库</title><meta description="主线程请求网络程序闪退，因为网络请求是耗时操作，所以我们一般都需要在新的线程中执行 可以尝试一下"><meta property="og:type" content="article"><meta property="og:title" content="主线程请求网络程序闪退"><meta property="og:url" content="https://www.zpf23.cn/2021/2021-2-18-NetworkRunUi.html"><meta property="og:site_name" content="赵鹏飞"><meta property="og:description" content="主线程请求网络程序闪退，因为网络请求是耗时操作，所以我们一般都需要在新的线程中执行 可以尝试一下"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://avatars1.githubusercontent.com/u/27126222?s=460&amp;u=84c5ad9ced5374cd3f9361cd736c64bb2e20905c&amp;v=4"><meta property="article:published_time" content="2021-02-18T13:58:46.000Z"><meta property="article:modified_time" content="2021-02-19T04:11:19.323Z"><meta property="article:author" content="赵鹏飞"><meta property="article:tag" content="问题"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://avatars1.githubusercontent.com/u/27126222?s=460&amp;u=84c5ad9ced5374cd3f9361cd736c64bb2e20905c&amp;v=4"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.zpf23.cn/2021/2021-2-18-NetworkRunUi.html"},"headline":"主线程请求网络程序闪退","image":["https://image.smodel.top/images/logo.png"],"datePublished":"2021-02-18T13:58:46.000Z","dateModified":"2021-02-19T04:11:19.323Z","author":{"@type":"Person","name":"赵鹏飞"},"description":"主线程请求网络程序闪退，因为网络请求是耗时操作，所以我们一般都需要在新的线程中执行 可以尝试一下"}</script><link rel="alternative" href="/atom.xml" title="赵鹏飞的笔记库" type="application/atom+xml"><link rel="icon" href="https://image.smodel.top/images/logo.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.12/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/css/style.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://image.smodel.top/images/logo.png" alt="赵鹏飞的笔记库" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Open my GitHub" href="https://github.com/zhao-pf"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-02-18  <span class="level-item"><i class="far fa-clock"> </i>5 分钟  <i class="fas fa-pencil-alt"> </i>0.7 k</span></div></div><h1 class="title is-3 is-size-4-mobile">主线程请求网络程序闪退</h1><div class="content"><p>主线程请求网络程序闪退，因为网络请求是耗时操作，所以我们一般都需要在新的线程中执行</p>
<p>可以尝试一下</p>
<a id="more"></a>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient okHttpClient = new OkHttpClient();</span><br><span class="line">Request request = new Request.Builder()</span><br><span class="line">        .url("http://smodel.top")</span><br><span class="line">        .build();</span><br><span class="line">try &#123;</span><br><span class="line">    Response execute = okHttpClient.newCall(request).execute();</span><br><span class="line">    Log.e("主线程", execute.body().string());</span><br><span class="line">&#125; catch (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当运行时候会爆出<br>java.lang.RuntimeException: Unable to start activity ComponentInfo{com.techstreat.networkrunui/com.techstreat.networkrunui.MainActivity}: android.os.NetworkOnMainThreadException</p>
<p>我们可以看一下官方的解释<br>The exception that is thrown when an application attempts<br>to perform a networking operation on its main thread.</p>
<p>This is only thrown for applications targeting the Honeycomb
SDK or higher.  Applications targeting earlier SDK versions
are allowed to do networking on their main event loop threads,
but it's heavily discouraged.  See the document
<a href="{@docRoot}guide/practices/design/responsiveness.html">
Designing for Responsiveness</a>.
<p>Also see {@link StrictMode}.


<p>大概的意思就是应用程序发送异常，在主线程执行联网操作，早期的SDK版本支持，但是后来google改善了他，不鼓励在主线程执行联网操作，<br>详情：<a href="https://developer.android.google.cn/training/articles/perf-anr">https://developer.android.google.cn/training/articles/perf-anr</a><br>当应用无法响应用户输入时，系统即会显示 ANR。例如，如果应用在界面线程中屏蔽了某些 I/O 操作（通常是网络访问），导致系统无法处理传入的用户输入事件。或者，应用在界面线程中花费太多时间构建复杂的内存结构或计算游戏的下一个走法。确保高效的计算始终至关重要，但即使最高效的代码仍然需要时间来运行。<br>在您的应用面临任何可能需要执行冗长的操作的情况下，您不应在界面线程中执行这些操作，而是应该创建工作线程并在其中执行大部分操作。<br><img src="https://developer.android.google.cn/images/anr.png" alt="1.png"><br>点击进入查看StrictMode<br>StrictMode is a developer tool which detects things you might be doing by accident and brings<br>them to your attention so you can fix them.<br>可以看到这个是一个开发者工具，他可以检测到出现的异常，并且抛出异常，以便开发者修他<br>他主要是用来检测I/O和网络请求</p>
<p>可以看到在StrictMode中有一个内部类ThreadPolicy 线程策略，在里面我们可以看到LAX<br>他的描述，不捕获任何的错误，松散的策略<br>在主代码中设置策略为LAX即可<br>StrictMode.setThreadPolicy(StrictMode.ThreadPolicy.LAX); //宽容模式</p>
<p>我们再次运行，会看到，我们的程序会阻塞，直到网络请求完毕,如果长时间阻塞主线程将会显示ARN<br>特定的场合可以使用这种模式，但是在一般开发中，建议不要设置，将错误修复，不然对用户体验很不好</p>
</div><ul class="post-copyright"><li><strong>本文标题：</strong><a href="https://www.zpf23.cn/2021/2021-2-18-NetworkRunUi.html">主线程请求网络程序闪退</a></li><li><strong>本文作者：</strong><a href="https://www.zpf23.cn">赵鹏飞</a></li><li><strong>本文链接：</strong><a href="https://www.zpf23.cn/2021/2021-2-18-NetworkRunUi.html">https://www.zpf23.cn/2021/2021-2-18-NetworkRunUi.html</a></li><li><strong>版权声明：</strong><span>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</span></li></ul><!--!--></article></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/2021-2-19-REWifi.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">循环关闭WIFI的小工具</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/2020-10-23-Hook.html"><span class="level-item">猿人学爬虫对抗赛11题</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><!--!--><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="" src="https://avatars1.githubusercontent.com/u/27126222?s=460&amp;u=84c5ad9ced5374cd3f9361cd736c64bb2e20905c&amp;v=4" alt="赵鹏飞"></figure><p class="title is-size-4 is-block line-height-inherit">赵鹏飞</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>山西’太原</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">39</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">11</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/zhao-pf" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/zhao-pf"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Weibo" href="http://www.weibo.com/5997997257"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Email" href="/zhaopengfei779@gmail.com"><i class="fa fa-envelope"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2021-03-02T05:33:46.000Z">2021-03-02</time></p><p class="title is-6"><a class="link-muted" href="/2021/2021-2-28-File.html">Java-文件相关操作</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/Java/">Java</a> / <a class="link-muted" href="/categories/Java/Java%E5%B7%A5%E5%85%B7%E7%B1%BB/">Java工具类</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-24T02:55:46.000Z">2021-02-24</time></p><p class="title is-6"><a class="link-muted" href="/2021/2021-2-22-Base64.html">Java-Base64</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/Java/">Java</a> / <a class="link-muted" href="/categories/Java/Java%E5%B7%A5%E5%85%B7%E7%B1%BB/">Java工具类</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-22T06:43:46.000Z">2021-02-22</time></p><p class="title is-6"><a class="link-muted" href="/2021/2021-2-21-JavaDate.html">Java-Date</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/Java/">Java</a> / <a class="link-muted" href="/categories/Java/Java%E5%B7%A5%E5%85%B7%E7%B1%BB/">Java工具类</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-21T05:17:46.000Z">2021-02-21</time></p><p class="title is-6"><a class="link-muted" href="/2021/2021-2-21-ArrayListCollections%20copy.html">Java-Collections</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/Java/">Java</a> / <a class="link-muted" href="/categories/Java/Java%E5%B7%A5%E5%85%B7%E7%B1%BB/">Java工具类</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2021-02-19T03:03:46.000Z">2021-02-19</time></p><p class="title is-6"><a class="link-muted" href="/2021/2021-2-19-REWifi.html">循环关闭WIFI的小工具</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/Android/">Android</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Android/"><span class="level-start"><span class="level-item">Android</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Java/Java%E5%B7%A5%E5%85%B7%E7%B1%BB/"><span class="level-start"><span class="level-item">Java工具类</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%9D%91/"><span class="level-start"><span class="level-item">坑</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%B5%84%E6%BA%90/"><span class="level-start"><span class="level-item">资源</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%80%86%E5%90%91/"><span class="level-start"><span class="level-item">逆向</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%80%86%E5%90%91%E5%AE%89%E5%85%A8/"><span class="level-start"><span class="level-item">逆向安全</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/%E9%97%AE%E9%A2%98/"><span class="tag">问题</span><span class="tag is-grey-lightest">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%99%E7%A8%8B/"><span class="tag">教程</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java%E5%9F%BA%E7%A1%80/"><span class="tag">Java基础</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%9D%91/"><span class="tag">坑</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%82%E6%96%87/"><span class="tag">杂文</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Android%E9%97%AE%E9%A2%98/"><span class="tag">Android问题</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BC%80%E5%8F%91%E7%9A%84APP/"><span class="tag">开发的APP</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%82%E8%B0%88/"><span class="tag">杂谈</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98/"><span class="tag">其他问题</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%82%E8%81%8A/"><span class="tag">杂聊</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%B5%84%E6%BA%90/"><span class="tag">资源</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><p class="size-small"><span>&copy; 2021 赵鹏飞</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>,Modify by <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">removeif</a> <br><span>© <a href="http://www.beian.miit.gov.cn/" target="_blank">晋ICP备20002936号</a><br></span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="掘金" href="https://juejin.im/user/5b8cd29ff265da43481603d9"><i class="fab fa-android"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="2364053447" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://www.zpf23.cn',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer></script><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.12/js/lightgallery-all.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><!--!--><!--!--><!--!--><script src="/js/toc.js" defer></script><script src="/js/main.js" defer></script><link rel="stylesheet" href="/css/insight.css"><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="想要查找什么..."><span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>(function (window) {
            var INSIGHT_CONFIG = {
                TRANSLATION: {
                    POSTS: '文章',
                    PAGES: '页面',
                    CATEGORIES: '分类',
                    TAGS: '标签',
                    UNTITLED: '(无标题)',
                },
                CONTENT_URL: '/content.json',
            };
            window.INSIGHT_CONFIG = INSIGHT_CONFIG;
        })(window);</script><script src="/js/insight.js" defer></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(false){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('undefined','undefined','undefined','undefined',undefined);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body><canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;"></canvas><script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script type="text/javascript" src="/js/fireworks.js"></script></html>